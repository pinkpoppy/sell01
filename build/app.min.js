
var app=(function(){var
configUrlMap={APIBase:"http://192.168.1.7:7784/pjapi/"},config={Base64Key:"RkVB2p5ida3ywUDJf7IgXcoGrm8TjOEAb",userId:'oUeq9t-m7cPT5sAb7V7nPTfxbnpU',userType:"12",headPic:'',nickname:'',sex:'',intro:'',country:'',pro:'',city:'',dis:''},localArr=['n','t','p','c','d','de'],browser={versions:function(){var
u=window.navigator.userAgent,app=window.navigator.appVersion;return{trident:u.indexOf('Trident')>-1,presto:u.indexOf('Presto')>-1,webKit:u.indexOf('AppleWebKit')>-1,gecko:u.indexOf('Gecko')>-1&&u.indexOf('KHTML')==-1,mobile:!!u.match(/AppleWebKit.*Mobile.*/),ios:!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:u.indexOf('Android')>-1||u.indexOf('Linux')>-1,iPhone:u.indexOf('iPhone')>-1,iPad:u.indexOf('iPad')>-1,webApp:u.indexOf('Safari')==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};var
moduleId=1,pageId=1;var
appState={module:moduleId,page:pageId,storageType:"localStorage",storageArr:localArr};function calScreenWidth(){return screen.width}
function calScreenHeight(){return screen.height}
function getSearchArgFromUrl(){var searchString=window.location.search
var res={}
if(searchString.length>0){var argArr=searchString.substr(1,searchString.length-1).split('&')
for(var i=0;i<argArr.length;i++){var coupleArg=argArr[i].split('=')
console.log(coupleArg)
res[coupleArg[0]]=coupleArg[1]}}
return res}
function deviceInfo(){var
devicePlat=browser.versions,device="";if(devicePlat.ios){device="iphone"}else if(devicePlat.android){device="android"}
return device}
function browserInfo(){if(browser.versions.mobile){var ua=navigator.userAgent.toLowerCase()
if(ua.match(/MicroMessenger/i)=="micromessenger"){return"weixin"}else if(ua.match(/WeiBo/i)=="weibo"){return"weibo"}else if(ua.match(/QQ/i)=="qq"){return qq}else if(browser.versions.ios){return"ios"}else if(browser.versions.android){return"android"}}else{return"pc"}}
function appVersion(){var version="2.2.0"
return version}
function timestamp(){return parseInt(new Date()/1000)}
function ajaxLog(path,des,feedback){console.log(path+" "+des+" "+feedback)}
function pathInfo(addPath){var
l=window.location,host=l.protocol+"//"+l.host,pathname=l.pathname,path=pathname.substring(0,pathname.lastIndexOf('/')+1),newPathName=host+path+addPath;return newPathName}
function initStorage(type){try{var
storage=window[type];return true}
catch(e){alert("错误类型: "+e.name)
return false}}
function AES(plainText,timestamp){pkcs7=function(str){var len=str.length,block_size=32,pad=block_size-(len%block_size),padChar=String.fromCharCode(pad);for(var i=0;i<pad;i++){str=str+padChar}
return str}
var Base64Key=config['Base64Key']+timestamp+'=',key=CryptoJS.enc.Base64.parse(Base64Key),iv=key.left(16);plainText=unescape(encodeURIComponent(plainText))
var text=CryptoJS.enc.Latin1.parse(pkcs7(plainText));ciphertext=CryptoJS.AES.encrypt(text,key,{iv:iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.NoPadding}),base64Text=CryptoJS.enc.Base64.stringify(ciphertext.ciphertext)
return base64Text}
function appAjax(des,methodName,requestType,userData,timestamp,succeedCallback){var
path=configUrlMap['APIBase'],data=jointPostData(methodName,timestamp,AES(userData,timestamp));$.ajax({url:path,method:requestType,dataType:'json',data:data}).done(function(data){ajaxLog(path,des,'successed')
succeedCallback(data)}).fail(function(data){ajaxLog(path,des,'failed')}).always(function(data){ajaxLog(path,des,'completed')});}
function getUserinfoData(){var u={};u.userId=config.userId
u.userType=config.userType
u.headPic=config.headPic
u.nickname=config.nickname
u.sex=config.sex
u.intro=config.intro
u.version=appVersion()
u.deviceMode=deviceInfo()
console.log("u in getUserinfoData "+u.userId)
return u}
function jointPostData(m,t,p){return data={"m":m,"t":t,"p":p}}
return{urls:configUrlMap,screenSize:calScreenWidth,appState:appState,config:config,methods:{produceSeperateWineHtml:produceSeperateWineHtml,getSearchArgFromUrl:getSearchArgFromUrl,deviceInfo:deviceInfo,appVersion:appVersion,timestamp:timestamp,getBasicUserinfo:getUserinfoData,appAjax:appAjax,browser:browserInfo,pathInfo:pathInfo,setBgImage:setBgImage,initStorage:initStorage,localArr:localArr,setModalMask:setModalMask,isLegalMobilePhone:isLegalMobilePhone}}
function setBgImage(str){if(str.search('focus')!=-1){str=str.replace('focus','blur')}else if(str.search('blur')!=-1){str=str.replace('blur','focus')}
return str}
function produceSeperateWineHtml(currentWine,wrap,wineIndex,moduleIndex,moduleLength,wineLength,moduleId)
{var itemHeight=0;if(arguments.length==5){currentWine=arguments[0],wrap=arguments[1],wineIndex=arguments[2],wineLength=arguments[3],moduleId=arguments[4];}
var
screenWidth=app.screenSize(),imgWidth=liWidth=parseInt(parseInt((screenWidth-26)/2)),ratio=1.0,imgHeight=Math.ceil(imgWidth*ratio),liBottomHeight=70,liHeight=imgHeight+liBottomHeight,remaining=currentWine['shortage'],remainingStr='',winePic=""
if(remaining!==''&&remaining!==undefined){remainingStr="<div class='cnt-info'>"
+"<div>"
+"<div>仅剩</div>"
+"<span>"+currentWine['inventory']+"</span>"
+"</div>"
+"</div>"}
if(currentWine['pics'].length!=0){winePic=currentWine['pics'][0]['pic']}
var $li=$("<li></li>")
$(wrap).append($li)
var str="<div class='wine-wrap' style='width:"+imgWidth+"'px;>"
+"<div class='div-up' style='width:'"+imgWidth+"px;>"
+"<a class='wine-detail' href='"
+pathInfo("detail.php?id=")
+currentWine['id']
+"'data-id='"
+currentWine['id']
+"' style='height:"+imgHeight+"px'>"
+"<img class='wine-img' src='"
+winePic
+"' style='width:"+imgWidth+"px;height:"+imgHeight+"px'>"
+"</a>"
+"<span class='mail-info'>"
+currentWine['discount']
+"</span>"
+remainingStr
+"<span class='subtitle'>"
+currentWine['subtitle']
+"</span>"
+"</div>"
+"<div class='div-bottom' style='height:"+liBottomHeight+"px;width:"+imgWidth+"px;'>"
+"<div class='headline'>"+currentWine['title']+"</div>"
+"<div class='sell-info'>"
+"<span class='market'>"
+'&yen;'+currentWine['market']
+"</span>"
+"<del>"+currentWine['price']+"</del>"
+"<span class='limit-goods'>"+currentWine['limit']+"</span>"
+"</div>"
+"</div>"
+"</div>"
$li.append($(str))
var
y=parseInt(wineIndex/2)*liHeight,base=42,liMargin=15,rightColumnStart=8+liWidth+10;if(wineIndex==0){$li.css({left:'8',top:y+base});}else if(wineIndex%2==0&&wineIndex!==0){$li.css({left:'8',top:y+base+liMargin*parseInt(wineIndex/2)});}else if(wineIndex%2==1){if(wineIndex==1){$li.css({left:rightColumnStart,top:y+base});}else{$li.css({left:rightColumnStart,top:y+base+liMargin*parseInt(wineIndex/2)})}}
itemHeight=Math.ceil(parseFloat($li.css('height')))
if(arguments.length==7){if(moduleIndex==moduleLength-1&&((wineIndex==wineLength-1)||(wineIndex==wineLength-2))){$li.addClass('last-wine-item')}}else if(arguments.length==6){console.log("arguments.length: "+arguments.length)
if(wineIndex==wineLength-1||wineIndex==wineLength-2){$li.addClass('last-wine-item')}}
return itemHeight}
function setModalMask(ele){var
screenW=parseFloat(calScreenWidth()),screenH=parseFloat(calScreenHeight()),boxW=Math.ceil(parseFloat(screenW*0.84)),boxH=Math.ceil(parseFloat(screenH*0.46));$(ele).css('width',screenW+'px')
$(ele).css('height',screenH+'px')
$(ele).children('.modal-body').css('width',boxW+'px')
$(ele).children('.modal-body').css('height',boxH+'px')}
function isInputEmpty(str){if(str.length==0){return true}}
function isLegalMobilePhone(str){var
mpReg=/1[^0126][0-9]{9}/;if(isInputEmpty(str)){return"EMPTY"}else{if(mpReg.test(str)){return true}
return false}}}());